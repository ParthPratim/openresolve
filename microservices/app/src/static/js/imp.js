var chatData=function(){return{set:function(e,t,s,a,o){this.sender=e,this.msg_textbox=t,this.timestamp=s,this.cno=a,this.element=o},addToUI:function(e){var t=Cookie.read("hasura_auth_uikit");if(t){var s=null;if(0==(t=JSON.parse(t)).user_info.username.localeCompare(this.sender)||1==e)s=$('<div class="imchat col s8 your-text"><div class="chat-sender col s12"><span>You</span></div><div class="chat-text col s12"><div><span class="flow-text">'+this.msg_textbox+'</span></div></div><span class="chat-timestamp">'+this.timestamp+'</span><input name="cno" type="hidden" value="'+this.cno+'"></div>');else s=$('<div class="imchat col s8"><div class="chat-sender col s12"><span>'+this.sender+'</span></div><div class="chat-text col s12"><div><span class="flow-text">'+this.msg_textbox+'</span></div></div><span class="chat-timestamp">'+this.timestamp+'</span><input name="cno" type="hidden" value="'+this.cno+'"></div>');$(".imchats").append(s),this.element=s}}}};function focusOnChat(){$(".imchats").scrollTop($(".imchats")[0].scrollHeight)}var IM={set:function(){this.chatArr=[],this.currChats=[],this.assert_storage();var n=function(i){var r=[];i.chats_extractor();$.ajax({type:"get",url:"https://openresolve.enamor68.hasura-app.io/im/fetchmsgs?issueid="+$("input[name=issue-id]").val(),success:function(e){for(var t=JSON.parse(e),s=0;s<t.length;s++){var a=new chatData;a.set(t[s].username,t[s].chatmsg,t[s].timestamp,t[s].cno,null),r.push(a)}var o=i.chatArr.length;if(0==o){for(s=0;s<r.length;s++)r[s].addToUI(),focusOnChat();i.chatArr=r}else{$(i.chatArr[o-1].element).remove(),i.chatArr.pop();for(s=o-1;s<r.length;s++)r[s].addToUI(),1<r.length-(o-1)&&focusOnChat(),i.chatArr.push(r[s])}setTimeout(function(){n(i)},2e3)},error:function(e){console.log(e.statusText)}})};n(this)},newChat:function(){"use strict";var e={chat_msg:$("input[name=msg-txtbox]").val(),issueid:$("input[name=issue-id]").val()};$("input[name=msg-txtbox]").val(" ");$.ajax({type:"post",url:"https://openresolve.enamor68.hasura-app.io/im/newmsg",data:e,success:function(e){},error:function(e){makeToast("Failed to send message...")}})},chats_extractor:function(){"use strict";var e=$(".imchat"),n=(e.length,this);n.chatArr=[],e.each(function(e,t){var s=$(t).find(".chat-text .flow-text").text(),a=$(t).find(".chat-sender span").text(),o=$(t).find(".chat-timestamp").text(),i=$(t).find("input[name=cno]").text(),r=new chatData;r.set(a,s,o,i,t),n.chatArr.push(r)})},len:function(e){var t=0;for(var s in e)e.hasOwnProperty(s)&&t++;return t},fetchChats:function(e){e.latestChats($("input[name=issue-id]").val())},assert_storage:function(){for(var e=0;e<this.chatArr.length;e++);}},im=IM;im.set();var Cookie={read:function(e){for(cookie_data=document.cookie,cookies=cookie_data.split(";"),i=0;i<cookies.length;i++)if(cookie=cookies[i],ceql=cookie.indexOf("="),cookie_name=cookie.substring(0,ceql),rcookie_data=cookie.substring(ceql+1),0==cookie_name.localeCompare(e))return rcookie_data}};function tryToEdit(){makeToast("Registering you as the Editor...");var e=$("input[name=issue-id]").val();$.ajax({type:"get",url:"https://openresolve.enamor68.hasura-app.io/ill_edit/"+e,success:function(t){try{jersp=JSON.parse(t),jersp.editor&&($(".curr-editor").html(jersp.editor),$("#begin-edit").removeClass("waves-effect waves-light submit").addClass("disabled"),$("#request-abort").removeClass("waves-effect waves-light submit").removeClass("disabled"),$("#finish-edit").show())}catch(e){makeToast(t)}},error:function(e){makeToast("Oops...Some error has occured...")}})}function fetcheditor(){var e=$("input[name=issue-id]").val();$.ajax({type:"get",url:"https://openresolve.enamor68.hasura-app.io/issue_editor/"+e,success:function(e){try{d=JSON.parse(e),d.editor?0==d.editor.localeCompare(JSON.parse(Cookie.read("hasura_auth_uikit")).user_info.username)?(0!=$(".curr-editor").html().localeCompare("You")&&(console.log("CP : A"),LoadAbortRequests()),$(".curr-editor").html("You"),$("#finish-edit").show(),$("#begin-edit").addClass("waves-effect waves-light submit").addClass("disabled"),$("#request-abort").addClass("waves-effect waves-light submit").addClass("disabled"),updateSource()):($(".curr-editor").html(d.editor),$("#finish-edit").hide(),$("#request-abort").addClass("waves-effect waves-light submit").removeClass("disabled"),$("#begin-edit").addClass("waves-effect waves-light submit").addClass("disabled"),setTimeout(loadRecentSource,2e3)):($(".curr-editor").html("None"),$("#finish-edit").hide(),$("#request-abort").addClass("waves-effect waves-light submit").addClass("disabled"),$("#begin-edit").addClass("waves-effect waves-light submit").removeClass("disabled"))}catch(e){$(".curr-editor").html("")}setTimeout(fetcheditor,2e3)}})}function checkARSStatus(){$.ajax({type:"get",url:"https://openresolve.enamor68.hasura-app.io/ar_status/"+$("input[name=issue-id]").val(),success:function(e){json=JSON.parse(e);var t=0,s=0;0<json.length?1==json[i].answer?t++:s++:setTimeout(checkARSStatus,2e3),0<t&&makeToast(t+" Abort Requests sent by you were Accepted"),0<s&&makeToast(s+" Abort Requests sent by you were Declined")}})}function LoadAbortRequests(){$.ajax({type:"get",url:"https://openresolve.enamor68.hasura-app.io/abort_requests/"+$("input[name=issue-id]").val(),success:function(e){if(jresp=JSON.parse(e),ar_users="",0<jresp.length){for(var t=0;t<jresp.length;t++)ar_users+=jresp[t].username+(t<jresp.length-1?",":"");$(".ar_body").html(ar_users+" requested you to abort editing"),$("#modal1").modal("open"),$("#modal1 .modal-content input").val(ar_users)}else console.log("CP : B"),setTimeout(LoadAbortRequests,2e3)}})}function finish_edit(){makeToast("Finishing Editing..."),$.ajax({type:"get",url:"https://openresolve.enamor68.hasura-app.io/finish_edit/"+$("input[name=issue-id]").val(),success:function(e){status=JSON.parse(e),0==status.status.localeCompare("edit_finished")?(console.log("FINISHED EDITING"),fetcheditor()):console.log("FAILED TO FINISH EDITING: TRY AGAIN")},error:function(e){makeToast("Oops...there was some error")}})}$("#imp-mod").submit(function(){return im.newChat(),!1}),$("#begin-edit").click(tryToEdit),fetcheditor(),$("#request-abort").click(function(){makeToast("Requesting Editor to Abort Editing..."),$.ajax({type:"get",url:"https://openresolve.enamor68.hasura-app.io/requestAbort/"+$("input[name=issue-id]").val(),success:function(t){try{jresp=JSON.parse(t),0==jresp.status.localeCompare("sent")?(makeToast("Your request has been sent"),setTimeout(checkARSStatus,2e3)):makeToast("Failed to send request")}catch(e){makeToast(t)}},error:function(e){makeToast("Error: Can't connect to host...")}})}),$(".modal-accept").click(function(){ar_users=$(".modal-content input").val(),$.ajax({type:"post",url:"https://openresolve.enamor68.hasura-app.io/actionabort/"+$("input[name=issue-id]").val()+"/1",data:{ar_users:ar_users},success:function(e){console.log("ABORT REQUEST : ACCEPTED"),console.log("CP : C"),finish_edit(),setTimeout(LoadAbortRequests,2e3)},error:function(e){console.log("ABORT REQUEST : NO-STATUS")}})}),$(".modal-decline").click(function(){ar_users=$(".modal-content input").val(),$.ajax({type:"post",url:"https://openresolve.enamor68.hasura-app.io/actionabort/"+$("input[name=issue-id]").val()+"/0",data:{ar_users:ar_users},success:function(e){console.log("ABORT REQUEST : ACCEPTED"),console.log("CP : D"),setTimeout(LoadAbortRequests,2e3)},error:function(e){console.log("ABORT REQUEST : NO-STATUS")}})}),$("#finish-edit").click(finish_edit);var src_now="";function updateSource(){if(0==CodeEditor.getText().localeCompare(src_now))return!1;src_now=CodeEditor.getText(),$.ajax({type:"post",url:"https://openresolve.enamor68.hasura-app.io/source_update/"+$("input[name=issue-id]").val(),data:{source_code:CodeEditor.getText(),line_num:CodeEditor.getCursor().row+1},success:function(e){u_s=JSON.parse(e),0==u_s.status.localeCompare("updated")?console.log("Updated Source"):console.log("Source not updated")}})}function loadRecentSource(){$.ajax({type:"get",url:"https://openresolve.enamor68.hasura-app.io/load_source/"+$("input[name=issue-id]").val(),success:function(e){code=JSON.parse(e),CodeEditor.editText(code.source_code),CodeEditor.setCursor(code.line_num)}})}function fetchContribs(){$.ajax({type:"get",url:"https://openresolve.enamor68.hasura-app.io/contributors_list/"+$("input[name=issue-id]").val(),success:function(e){js_cl=JSON.parse(e),$("#contributors").html("");for(var t=0;t<js_cl.length;t++)$("#contributors").append('<div class="contrib-us"><i class="small material-icons">account_circle</i><span>'+js_cl[t].username+"</span></div>")}})}$("#load-last-code").click(function(){makeToast("Loading last edited code..."),loadRecentSource()}),$("#load-original-code").click(function(){makeToast("Loading original edited code...");$.ajax(original_source_code_link).done(function(e){CodeEditor.editText(e),CodeEditor.setCursor(0)}).fail(function(e){CodeEditor.editText()}).always(function(){})}),fetchContribs(),setInterval(fetchContribs,1e4),$("#view-problem").click(function(){makeToast("Loading problem with the code..."),$.ajax({type:"get",url:"https://openresolve.enamor68.hasura-app.io/view_problem/"+$("input[name=issue-id]").val(),success:function(e){json_vp=JSON.parse(e),$("#problem_body").html(json_vp[0].problem),$("#modal2").modal("open")},error:function(e){makeToast("Could not fetch the problem statement...")}})}),$("#mark-resolve").click(function(){makeToast("Marking Issue as resolved..."),$.ajax({type:"get",url:"https://openresolve.enamor68.hasura-app.io/markresolve/"+$("input[name=issue-id]").val(),success:function(t){try{cd=JSON.parse(t),0==cd.status.localeCompare("marked")&&($(".resolve-flag").html("Resolved"),$(".resolve-flag").removeClass("red").addClass("green"))}catch(e){makeToast(t)}},error:function(e){makeToast("Could not mark the issue as resolved...")}})});